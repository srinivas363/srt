{
	"Resources": {
		"myvpc":{
		"Type":"AWS::EC2::VPC",
		"Properties":{
			"CidrBlock":"10.0.0.0/16",
			"Tags":[
			{"Key":"Name",
			"Value":"App1-Vpc"
			},
			{"Key":"Env",
			"Value":"Dev"
			}
					]
					}
				},
		"sn1":{
		"Type":"AWS::EC2::Subnet",
		"Properties":{
			"CidrBlock":"10.0.0.0/24",
			"VpcId":{"Ref":"myvpc"},
			"AvailabilityZone":"ap-southeast-1a"
						}
				},
		"sn2":{
		"Type":"AWS::EC2::Subnet",
		"Properties":{
			"CidrBlock":"10.0.1.0/24",
			"VpcId":{"Ref":"myvpc"},
			"AvailabilityZone":"ap-southeast-1b"
						}
				},
		"sn3":{
		"Type":"AWS::EC2::Subnet",
		"Properties":{
			"CidrBlock":"10.0.2.0/24",
			"VpcId":{"Ref":"myvpc"},
			"AvailabilityZone":"ap-southeast-1c"
						}
				},
		
		"sn4":{
		"Type":"AWS::EC2::Subnet",
		"Properties":{
			"CidrBlock":"10.0.3.0/24",
			"VpcId":{"Ref":"myvpc"},
			"AvailabilityZone":"ap-southeast-1a"
						}
				},
		"sn5":{
		"Type":"AWS::EC2::Subnet",
		"Properties":{
			"CidrBlock":"10.0.4.0/24",
			"VpcId":{"Ref":"myvpc"},
			"AvailabilityZone":"ap-southeast-1b"
						}
				},
		"sn6":{
		"Type":"AWS::EC2::Subnet",
		"Properties":{
			"CidrBlock":"10.0.5.0/24",
			"VpcId":{"Ref":"myvpc"},
			"AvailabilityZone":"ap-southeast-1c"
						}
				},
		"RT1":{
		"Type" : "AWS::EC2::RouteTable",
		"Properties" : {
		"VpcId" :{"Ref":"myvpc"}
						}
				},
			"RT2":{
		"Type" : "AWS::EC2::RouteTable",
		"Properties" : {
		"VpcId" :{"Ref":"myvpc"}
						}
				},
		"IG":{
		"Type" : "AWS::EC2::InternetGateway",
		"Properties" : {
		"Tags" : [
		{"Key":"Name",
		"Value":"IGW"}]
						}
	 		},
		"VPCIGattach":{
		 "Type" : "AWS::EC2::VPCGatewayAttachment",
		 "Properties" : {
		 "InternetGatewayId":{"Ref":"IG"},
		 "VpcId": {"Ref":"myvpc"}
						}
					},
		"ERTs1":{
		 "Type" : "AWS::EC2::Route",
		 "Properties" : {
		 "DestinationCidrBlock" :"0.0.0.0/0",
		 "GatewayId" :{"Ref":"IG"} ,
		 "RouteTableId" : {"Ref":"RT1"}
						 }
						},
	
		"SRTass1":{
			 "Type" : "AWS::EC2::SubnetRouteTableAssociation",
			 "Properties" : {
			 "RouteTableId" : {"Ref":"RT1"},
			 "SubnetId":{"Ref":"sn1"}
						 }
						},
		"SRTass2":{
			 "Type" : "AWS::EC2::SubnetRouteTableAssociation",
			 "Properties" : {
			 "RouteTableId" : {"Ref":"RT1"},
			 "SubnetId":{"Ref":"sn2"}
						 }
						},
		"SRTass3":{
			 "Type" : "AWS::EC2::SubnetRouteTableAssociation",
			 "Properties" : {
			 "RouteTableId" : {"Ref":"RT1"},
			 "SubnetId":{"Ref":"sn3"}
						 }
						},
		"NAT" : {
		 "Type" : "AWS::EC2::NatGateway",
		 "Properties" : {
		 "AllocationId" : { "Fn::GetAtt" : ["EIP", "AllocationId"]},
		 "SubnetId" : { "Ref" : "sn1"}
						 }
				},
		"EIP" : {
		 "Type" : "AWS::EC2::EIP",
		 "Properties" : {
		 "Domain" : "myvpc"
						 }
				},
		"ERTs2" : {
		 "Type" : "AWS::EC2::Route",
		 "Properties" : {
		 "RouteTableId" : { "Ref" : "RT2" },
		 "DestinationCidrBlock" : "0.0.0.0/0",
		 "NatGatewayId" : { "Ref" : "NAT" }
						 }
						},
		"SRT1ass4":{
			 "Type" : "AWS::EC2::SubnetRouteTableAssociation",
			 "Properties" : {
			 "RouteTableId" : {"Ref":"RT2"},
			 "SubnetId":{"Ref":"sn4"}
						 }
						},
		"SRT1ass5":{
			 "Type" : "AWS::EC2::SubnetRouteTableAssociation",
			 "Properties" : {
			 "RouteTableId" : {"Ref":"RT2"},
			 "SubnetId":{"Ref":"sn5"}
						 }
						},
		"SRT1ass6":{
			 "Type" : "AWS::EC2::SubnetRouteTableAssociation",
			 "Properties" : {
			 "RouteTableId" : {"Ref":"RT2"},
			 "SubnetId":{"Ref":"sn6"}
						 }
						},
		"tg":	{
		 "Type" : "AWS::ElasticLoadBalancingV2::TargetGroup",
		 "Properties" : {
		 "Name" :"TG" ,
		 "Port" : 80,
		 "Protocol" : "HTTP",
		 "VpcId": {"Ref":"myvpc"}
				}
				},
		"ELB":{
		 "Type" : "AWS::ElasticLoadBalancingV2::LoadBalancer",
		 "Properties" : { 
		 "Name" :"AELB",
		 "Subnets" :[{"Ref":"sn1"},{"Ref":"sn2"},{"Ref":"sn3"}]
		 }
		 },
		"LC1": {
		 "Type": "AWS::AutoScaling::LaunchConfiguration",
		 "Properties": {
		 "ImageId": "ami-04d9e855d716f9c99",
		 "InstanceType": "t2.micro",
		 "SecurityGroups" :[{"Ref":"SG1"}],
		 "UserData" :{"Fn::Base64":{"Fn::Join":["\n",["#! /binbash","apt-update","apt install apache2 -y"]]}}
				 }
				},
		"ASG1":	{
		 "Type" : "AWS::AutoScaling::AutoScalingGroup",
		 "Properties" : {
		  "AutoScalingGroupName" :"ASG",
		  "TargetGroupARNs" : [{"Ref":"tg"}],
		  "DesiredCapacity" : "3",
		  "MaxSize" :"5",
		  "MinSize" :"1",
		  "LaunchConfigurationName" :{"Ref":"LC1"},
		  "VPCZoneIdentifier" : [{"Ref":"sn4"},{"Ref":"sn5"},{"Ref":"sn6"}]
						}
				},
		"HZ":{
		 "Type" : "AWS::Route53::HostedZone",
		 "Properties" : {
		    "Name" :"abc.com"
						}
			},
		"RS":{
		 "Type" : "AWS::Route53::RecordSet",
		 "Properties" : {
			"Type":"A",
			"Name":"abc.com",
			"HostedZoneId":{"Ref":"HZ"},
			"AliasTarget":{
				   "DNSName":{"Fn::GetAtt":["ELB","DNSName"]},
				   "HostedZoneId":{"Fn::GetAtt":["ELB","CanonicalHostedZoneID"]}
		 }
		 }
		},
		
		"SG1":	{	
		 "Type" : "AWS::EC2::SecurityGroup",
		 "Properties" :
		 {
		 "GroupDescription" :"Allow http to client host",
		 "VpcId": {"Ref":"myvpc"},
		 "Tags":[
			{"Key":"Name",
			"Value":"SG1"
			}
					],
		 "SecurityGroupEgress" : [
			 {
			 "IpProtocol" : "tcp",
			 "FromPort" : "80",
			 "ToPort" : "80",
			 "CidrIp" : "0.0.0.0/0"
			 } ],
		 "SecurityGroupIngress" : [ 
			 {
			 "IpProtocol" : "tcp",
			 "FromPort" : "80",
			 "ToPort" : "80",
			 "CidrIp" : "0.0.0.0/0"
			 }]
		}
	}}
}